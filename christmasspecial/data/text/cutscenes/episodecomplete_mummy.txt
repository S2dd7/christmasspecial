// SETUP

#include endepisodegraphics_ladyluck.txt

// HELPER FUNCTIONS

function signanimate(sign) {
	var s = sign.show("turn");
	//s.onComplete(function() { resume(); sign.show("loop"); });
	//pause();
	while(!s.completed) {
		// do nothing
	}
	sign.show("loop");
}

function spinthewheel(sign, wheel, animation) {
  var s = sign.show("turn");
	//s.onComplete(function() { resume(); sign.show("loop"); });
	//pause();
	while(!s.completed) {
		// do nothing
	}
	sign.hide();

  wheel.x = 30;
  wheel.y = -30;
  play("spinthewheel");
	var s = wheel.show(animation);
	//s.onComplete(function() { resume(); sign.show("loop"); });
	//pause();
	while(!s.completed) {
		// do nothing
	}
	wheel.hide();
}

// ACTORS
actor("Lady Luck", screenwidthmid + 400, 100, Col.YELLOW, LEFT, TOP, "chat_ladyluck", "characters/misc/charicon_ladyluck");

var player = getplayername();
if(player == "Warrior"){
  actor("Warrior", 150, screenheight - 100, Col.LIGHTBLUE, LEFT, BOTTOM, "chat_warrior", "characters/warrior/charicon_warrior");
}else if(player == "Thief"){
  actor("Thief", 150, screenheight - 100, Col.multiplylightness(Col.GREEN, 1.25), LEFT, BOTTOM, "chat_thief", "characters/thief/charicon_thief");
}else if(player == "Robot"){
  actor("Robot", 150, screenheight - 100, 0xDDDDDD, LEFT, BOTTOM, "chat_robot", "characters/robot/charicon_robot");
}else if(player == "Inventor"){
  actor("Inventor", 150, screenheight - 100, 0xffe48d, LEFT, BOTTOM, "chat_inventor", "characters/inventor/charicon_inventor");
}else if(player == "Witch"){
  actor("Witch", 150, screenheight - 100, 0xb496ec, LEFT, BOTTOM, "chat_witch", "characters/witch/charicon_witch");
}
// INTRO

play("music_cutscene_lesscheery");

changebackground("intro_sign");

sign.y = -screenheight;
ladyluck_sign.y = -screenheight;
sign.show("loop");
ladyluck_sign.show("idle");

Actuate.tween(sign, 2, { y: 0 }).ease(Expo.easeOut);
Actuate.tween(ladyluck_sign, 2, { y: 0 }).ease(Expo.easeOut);

wait(0.5);

fadein();

wait(1.5);

ladyluck_sign.show("talking");
actor("Lady Luck", screenwidthmid + 200, 100, Col.YELLOW, LEFT, TOP, "chat_ladyluck", "characters/misc/charicon_ladyluck");

var firstlinevoice = false;
for(message in variables.messages_beforespin) {
  var mood = "normal";
  if(!firstlinevoice){
    firstlinevoice = true;
    speak("Lady Luck", message.text, "normal");
  }else{
    speak("Lady Luck", message.text);
  }
}

ladyluck_sign.show("idle");

ladyluck_sign.hide();

var wheelwins = chance(33); // 33% chance to win
spinthewheel(sign, wheel, wheelwins ? "spin2" : "spin1");

signanimate(sign);

ladyluck_sign.show("talking");
actor("Lady Luck", screenwidthmid + 200, 100, Col.YELLOW, LEFT, TOP, "chat_ladyluck", "characters/misc/charicon_ladyluck");

if (wheelwins) {
    speak("Lady Luck", "Wow, it looks like it landed on the prize!", "normal");
    speak("Lady Luck", "What do you want, " + player + "?");
    speak(player, "I want some candy!");
    speak("Lady Luck", "Really? Candy?");
    speak(player, "Yep!");
    speak("Lady Luck", "Okay then...");
} else {
    var secondlinevoice = false;
    for(message in variables.messages_afterspin) {
      var mood = "normal";
    	if(!secondlinevoice){
        secondlinevoice = true;
        speak("Lady Luck", message.text, "normal");
      }else{
        speak("Lady Luck", message.text);
      }
    }
}

ladyluck_sign.show("idle");

gamecompletefromcutscene();
